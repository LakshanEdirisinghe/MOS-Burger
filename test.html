<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventory Search Table</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- <script src="https://kit.fontawesome.com/a2d9d5a64c.js" crossorigin="anonymous"></script> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body class="m-4">

  <div class="card">
    <div class="card-body">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Item Code</th>
            <th scope="col">Item Name</th>
            <th scope="col">Category</th>
            <th scope="col">Supplier</th>
            <th scope="col">Qty</th>
            <th scope="col">Reorder Point</th>
            <th scope="col">Discount</th>
            <th scope="col" class="text-start">Unit Price (LKR)</th>
            <th scope="col" class="text-start">Total Price (LKR)</th>
            <th scope="col" class="text-start">On Hand Status</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let inventoryData = [
      {
        "itemCode": "B1001",
        "itemName": "Classic Burger (Large)",
        "price": 750,
        "discount": 0,
        "category": "Burger",
        "supplier": "MOS Kitchen",
        "qty": 25,
        "reorderPoint": 10
      },
      {
        "itemCode": "B1002",
        "itemName": "Classic Burger (Regular)",
        "price": 1500,
        "discount": 0,
        "category": "Burger",
        "supplier": "MOS Kitchen",
        "qty": 40,
        "reorderPoint": 15
      },
      {
        "itemCode": "B1003",
        "itemName": "Turkey Burger",
        "price": 1600,
        "discount": 0,
        "category": "Burger",
        "supplier": "Lanka Meats",
        "qty": 12,
        "reorderPoint": 5
      }
    ];
    console.log(JSON.parse(localStorage.getItem("invdb")) === null);

    if (JSON.parse(localStorage.getItem("invdb")) === null) {
      localStorage.setItem("invdb", JSON.stringify(inventoryData));

    }
    console.log(JSON.parse(localStorage.getItem("invdb")) === null);


    let tbody = document.getElementById("tableBody");
    let dataSet = JSON.parse(localStorage.getItem("invdb"));

    // clear tbody first
    tbody.innerHTML = "";

    // render rows
    for (let index = 0; index < dataSet.length; index++) {
      let row = `
        <tr>
          <td><span class="text-center">${dataSet[index].itemCode}</span></td>
          <td>${dataSet[index].itemName}</td>
          <td>${dataSet[index].category}</td>
          <td>${dataSet[index].supplier}</td>
          <td class="text-end">${dataSet[index].qty}</td>
          <td class="text-end">${dataSet[index].reorderPoint}</td>
          <td class="text-end">${(dataSet[index].discount * 100).toFixed(0)}%</td>
          <td class="text-end">${dataSet[index].price}</td>
          <td class="text-end">${(dataSet[index].price * dataSet[index].qty).toLocaleString()}</td>
          <td class="text-center">
            <span class="badge ${dataSet[index].qty > dataSet[index].reorderPoint ? "text-bg-success" : "text-bg-danger"}">
              ${dataSet[index].qty > dataSet[index].reorderPoint ? "In Stock" : "Low Stock"}
            </span>
          </td>
          <td class="text-center">
            <div class="btn-group">
              <button class="btn btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa-solid fa-gear fa-lg"></i>
              </button>
              <ul class="dropdown-menu">
                <li><a href="#" class="dropdown-item  btn-update" prKey="${dataSet[index].itemCode}"><i class="bi bi-arrow-repeat"></i> Update</a></li>
                <li><a href="#" class="dropdown-item  btn-delete" prKey="${dataSet[index].itemCode}"><i class="bi bi-ban"></i> Delete</a></li>

                
              </ul>
            </div>
          </td>
        </tr>`;
      tbody.innerHTML += row;
    }

    // attach events using normal for loop
    let updateBtns = document.getElementsByClassName("btn-update");
    let deleteBtns = document.getElementsByClassName("btn-delete");

    for (let i = 0; i < updateBtns.length; i++) {
      updateBtns[i].addEventListener("click", function () {
        let code = this.getAttribute("prKey");
        console.log(code);

      });
    }
    


    for (let i = 0; i < deleteBtns.length; i++) {
      deleteBtns[i].addEventListener("click", function () {
        let code = this.getAttribute("prKey");
        deleteItem(code);
      });
    }

    function deleteItem(itemCode) {

      const conferm = confirm("Do you want to delete this data row ?");

      if (conferm === true) {
        const confermText = prompt("Type 'Delete' word this box !");

        if (confermText === "delete") {
          let data = JSON.parse(localStorage.getItem("invdb")) || [];
          data = data.filter(item => item.itemCode !== itemCode); // remove matching row
          localStorage.setItem("invdb", JSON.stringify(data));
          // renderTable(data); // refresh without reload
          location.reload();

        } else {
          alert("Data deleting processing is canceled")
        }

      } else {
        alert("Data deleting processing is canceled")
      }

    }

  </script>
</body>

</html>